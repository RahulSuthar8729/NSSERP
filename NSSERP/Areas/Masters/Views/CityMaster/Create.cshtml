@model NSSERP.Areas.Masters.Models.CityMaster
@{
    ViewData["Title"] = "Create";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" integrity="..." crossorigin="anonymous" />
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="..."></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="..."></script>

<div class="container mt-4">
    <div class="card">
        <div class="card-header">
            <h2>Create City</h2>           
        </div>
        <div class="card-body">
            <form asp-controller="City" asp-action="Create" method="post">
                <div class="form-group">
                    <label asp-for="CityName" class="control-label">City Name</label>
                    <input asp-for="CityName" name="CityName" required class="form-control" />
                    <span asp-validation-for="CityName" class="text-danger"></span>
                </div>

                <div class="form-group">
                    <label asp-for="CountryID" class="control-label">Country</label>
                    <select id="CountryID" asp-for="CountryID" name="CountryID" required class="form-control">
                        <option value="">Select Country</option>
                        @foreach (var country in Model.Countries)
                        {
                            <option value="@country.Country_Code">@country.Country_Name</option>
                        }
                    </select>
                    <span asp-validation-for="CountryID" class="text-danger"></span>
                </div>

                <div class="form-group">
                    <label asp-for="StateID" class="control-label">State</label>
                    <select id="StateID" asp-for="StateID" name="StateID" required class="form-control">
                    </select>
                    <span asp-validation-for="StateID" class="text-danger"></span>
                </div>
                <script>
                    $(document).ready(function () {
                        $('#StateID').change(function () {
                            var selectedStateId = $(this).val();

                            $.ajax({
                                url: '/Masters/CityMaster/GetDistrictsByState', 
                                type: 'GET',
                                data: { stateId: selectedStateId },
                                success: function (data) {
                                    // Clear and populate district dropdown with retrieved districts
                                    $('#DistrictID').empty().append('<option value="" selected disabled>Select District</option>');
                                    $.each(data, function (index, district) {
                                        $('#DistrictID').append('<option value="' + district.districtID + '">' + district.districtName + '</option>');
                                    });
                                },
                                error: function (xhr, status, error) {
                                    console.log(error); // Handle errors if any
                                }
                            });

                            // Also, trigger an AJAX request here to fetch cities based on the selected state if needed
                        });
                    });

                </script>
                <div class="form-group">
                    <label for="DistrictID">District</label>
                    <select class="form-control" required id="DistrictID" name="DistrictID">
                        <option value="" selected disabled>Select District</option>
                    </select>
                </div>

                <div class="form-group">
                    <label asp-for="IsActive" class="control-label">Is Active</label>
                    <select asp-for="IsActive" id="IsActive" name="IsActive" class="form-control">
                        <option value="Y">Active</option>
                        <option value="N">Inactive</option>
                    </select>
                    <span asp-validation-for="IsActive" class="text-danger"></span>
                </div>


                <button type="submit" class="btn btn-primary">Create</button>
            </form>

            <div class="form-group">
                <br />
                <a href="/Masters/CityMaster/Index" class="btn btn-warning"><i class="fas fa-arrow-left"></i> Back</a>
            </div>
            <script>
                $(document).ready(function () {
                    $('#CountryID').change(function () {
                        var countryId = $(this).val();
                        $.ajax({
                            url: '/Masters/CityMaster/GetStatesByCountryJson',
                            method: 'GET',
                            data: { countryId: countryId },
                            success: function (data) {
                                console.log('Received data:', data);

                                $('#StateID').empty();
                                $('#StateID').append('<option value="">Select State</option>');

                                // Use camelCase when accessing properties
                                $.each(data, function (index, state) {
                                    $('#StateID').append('<option value="' + state.stateID + '">' + state.stateName + '</option>');
                                });
                            },
                            error: function () {
                                console.log('Error fetching states.');
                            }
                        });
                    });
                });


            </script>

        </div>
    </div>
</div>
